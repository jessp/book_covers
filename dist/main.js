!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n=class{constructor(){this.holder,this.magnifier,this.ctx,this.largeImages={},this.data,this.width,this.height,this.gridRows,this.gridColumns,this.spriteSheets,this.init=this.init.bind(this),this.setData=this.setData.bind(this),this.setSpriteSheets=this.setSpriteSheets.bind(this),this.setDimensions=this.setDimensions.bind(this),this.preloadLargeImages=this.preloadLargeImages.bind(this),this.getMousePos=this.getMousePos.bind(this),this.moveMagnifier=this.moveMagnifier.bind(this)}init(){this.holder=d3.select(".main").select("#mainCanvas"),this.magnifier=d3.select(".main").select("#magnifier"),this.magnifier.attr("width",300),this.magnifier.attr("height",300),this.ctx=this.magnifier.node().getContext("2d"),this.ctx.save()}setData(t){this.data=t}setSpriteSheets(t,e){this.spriteSheets=t,this.preloadLargeImages(e)}setDimensions(t,e,i,n){this.width=t,this.height=e,this.gridRows=i,this.gridColumns=n}preloadLargeImages(t){for(var e=0;e<t.length;e++){let i=t[e];if(i.grid_point&&!this.largeImages[i.isbn13]){let t=new Image,e=i.book_image;t.src=e;let n=this.largeImages;t.onload=function(){n[i.isbn13]=t}}}}getMousePos(t){var e=this.holder.node().getBoundingClientRect();return{x:(t.clientX-e.left)/(e.right-e.left)*this.holder.node().width,y:(t.clientY-e.top)/(e.bottom-e.top)*this.holder.node().height}}moveMagnifier(t){this.ctx.save();let e=this.width/this.gridColumns,i=this.height/this.gridRows,n=this.getMousePos(t),s=n.x/this.width*this.gridColumns,r=n.y/this.height*this.gridRows;if(this.magnifier.style("left",n.x-150+"px"),this.magnifier.style("top",n.y-150+"px"),this.data){let t=this.data.filter(function(t){return!!t.grid_point&&t.grid_point[0]>s-5&&t.grid_point[0]<s+5&&t.grid_point[1]>r-5&&t.grid_point[1]<r+5});for(var o=0;o<t.length;o++){let n=t[o];if(this.largeImages[n.isbn13])this.ctx.drawImage(this.largeImages[n.isbn13],150-4*e+(s-n.grid_point[0])*e*6,150-4*i+(r-n.grid_point[1])*i*6,6*e,6*i);else{let t=new Image,o=n.book_image;t.src=o;let a=this.largeImages;t.onload=function(){a[n.isbn13]=t},n.index<2500?this.ctx.drawImage(this.spriteSheets.one,20*n.index,0,20,30,150-4*e+(s-n.grid_point[0])*e*6,150-4*i+(r-n.grid_point[1])*i*6,6*e,6*i):this.ctx.drawImage(this.spriteSheets.two,20*(n.index-2500),0,20,30,150-4*e+(s-n.grid_point[0])*e*6,150-4*i+(r-n.grid_point[1])*i*6,6*e,6*i)}}}this.ctx.restore()}};let s,r,o,a,h,d,g=[],l=.6666667,c={},u=new n;function f(t,e,i){let n=new Image,s=t;n.src=s,n.onload=function(){c[e]=n,i()}}function p(){let t=o/s,e=a/r;d.save();for(var i=0;i<g.length;i++){const n=g[i];d.fillStyle=d3.hsl(n.hue/2,n.saturation/255,n.value/255),n.grid_point&&(i<2500?d.drawImage(c.one,20*i,0,20,30,n.grid_point[0]*t,n.grid_point[1]*e,t,e):d.drawImage(c.two,20*(i-2500),0,20,30,n.grid_point[0]*t,n.grid_point[1]*e,t,e))}d.restore()}window.onload=function(t){o=d3.select(".main").node().getBoundingClientRect().width,a=d3.select(".main").node().getBoundingClientRect().height,(h=d3.select(".main").select("#mainCanvas")).attr("width",o),h.attr("height",a),d=h.node().getContext("2d"),u.init(),window.addEventListener("mousemove",u.moveMagnifier,!1),d3.json("./../data/full_json_output.json").then(function(t){function e(){!function(t,e,i){let n=e/t*l;r=Math.ceil(Math.sqrt(n*i)),function(t,e,i){var n=!1;try{n=new XMLHttpRequest}catch(t){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){return alert("Your browser does not support AJAX!"),!1}}}n.open("POST",t,!0),n.onreadystatechange=function(){4==n.readyState&&i(n)},n.send(e)}("http://localhost:8070",[s=Math.ceil(Math.sqrt(i/n)),r],function(t){g=JSON.parse(t.responseText),u.setData(g),u.setDimensions(o,a,r,s),p()})}(o,a,t.length),u.setSpriteSheets(c,t)}f("./../images/sprite_sheet_1.jpg","one",()=>f("./../images/sprite_sheet_2.jpg","two",e))})}}]);